<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ¦¾ ë„ì „ ì¼ìƒ íŠ¹ì „ëŒ€! ì¼ì¼ë³´ê³  ê³„ì‚°ê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f7f7f7;
      margin: 20px;
    }
    textarea {
      width: 100%;
      height: 260px;
      padding: 10px;
      font-size: 14px;
      box-sizing: border-box;
    }
    button {
      margin: 6px 4px 0 0;
      padding: 9px 16px;
      font-size: 13.5px;
      cursor: pointer;
    }
    pre, .box {
      background: #fff;
      padding: 12px;
      margin-top: 12px;
      border: 1px solid #ccc;
      white-space: pre-wrap;
    }
    .group-buttons button.active {
      background: #222;
      color: #fff;
    }
  </style>
</head>
<body>

<h2>ğŸ¦¾ ë„ì „ ì¼ìƒ íŠ¹ì „ëŒ€! ì¼ì¼ë³´ê³  ìë™ ê³„ì‚°ê¸°</h2>

<div class="group-buttons">
  <strong>ì„ íƒ:</strong>
  <button class="active" onclick="selectGroup('1ì¡°', this)">1ì¡°</button>
  <button onclick="selectGroup('2ì¡°', this)">2ì¡°</button>
  <button onclick="selectGroup('3ì¡°', this)">3ì¡°</button>
  <button onclick="selectGroup('4ì¡°', this)">4ì¡°</button>
  <button onclick="selectGroup('5ì¡°', this)">5ì¡°</button>
  <button onclick="selectFinal(this)">ìµœì¢…</button>
</div>

<br>

<textarea id="input" placeholder="ì¼ì¼ë³´ê³  ì–‘ì‹ì„ ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”"></textarea>
<br>

<button onclick="processText()">ê²°ê³¼ ë³´ê¸°</button>
<button onclick="copyResult()">ë³µì‚¬í•˜ê¸°</button>

<h3>ğŸ“‹ ê²°ê³¼</h3>
<pre id="output"></pre>

<h3>âœ… í™•ì¸ìš© ìš”ì•½</h3>
<div class="box" id="summary"></div>

<script>
let selectedLabel = "1ì¡°";

/* ---------- ì¡° ì„ íƒ ---------- */
function selectGroup(label, btn) {
  selectedLabel = label;
  document.querySelectorAll(".group-buttons button")
    .forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
}

function selectFinal(btn) {
  const now = new Date();
  selectedLabel = `${now.getMonth() + 1}ì›” ${now.getDate()}ì¼ ìµœì¢…`;
  document.querySelectorAll(".group-buttons button")
    .forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
}

/* ---------- ìˆ«ì ìœ í‹¸ ---------- */
function getFrontNumber(v) {
  const m = v.trim().match(/^(\d+(\.\d+)?)/);
  return m ? parseFloat(m[1]) : 0;
}

function getBracketSum(v) {
  const m = v.match(/\(([^)]+)\)/);
  if (!m) return 0;
  const nums = m[1].match(/(\d*\.?\d+)/g);
  return nums ? nums.reduce((a, b) => a + parseFloat(b), 0) : 0;
}

/* ---------- ë©”ì¸ ì²˜ë¦¬ ---------- */
function processText() {
  const lines = document.getElementById("input").value.split("\n");

  let result = [];
  let sum = { f:0, i:0, m:0, t:0, s:0, score:0 };
  let people = 0;
  let warnings = [];

  for (let line of lines) {
    const raw = line;
    const t = line.trim();

    /* âœ… ì¡° ë¼ë²¨ë§Œ êµì²´ */
    if (t.endsWith("ì¡°")) {
      result.push(selectedLabel);
      continue;
    }

    /* âœ… ì¡°ì´ì ìˆ˜ ìœ„ì¹˜ ìœ ì§€ + ê°’ë§Œ ì±„ì›€ */
    if (t.startsWith("=> ì¡°ì´ì ìˆ˜")) {
      result.push(`=> ì¡°ì´ì ìˆ˜ : ${sum.score}ì `);
      continue;
    }

    /* âœ… ì‚¬ëŒ ì¤„ ì²˜ë¦¬ */
    if (t.includes("/") && t.split("/").length >= 6 && !t.startsWith("ì´ë¦„")) {
      const [name,f,i,m,t2,s2] = t.split("/");

      [["ì°¾ê¸°",f],["ì„­ì™¸",i],["ë§Œë‚¨",m],["ìƒë”°",t2],["ì„±ë”°",s2]].forEach(
        ([label,val]) => {
          const front = getFrontNumber(val);
          const br = getBracketSum(val);
          if (br > 0 && Math.abs(front - br) > 0.001) {
            warnings.push(`- ${name} / ${label}ì¹¸ì— ìˆ˜ì¹˜ì˜ í•©ê³„ê°€ í‹€ë¦½ë‹ˆë‹¤.`);
          }
        }
      );

      const ff = getFrontNumber(f);
      const ii = getFrontNumber(i);
      const mm = getFrontNumber(m);
      const tt = getFrontNumber(t2);
      const ss = getFrontNumber(s2);

      const score = ff + ii*2 + mm*3 + tt*4 + ss*5;

      sum.f += ff;
      sum.i += ii;
      sum.m += mm;
      sum.t += tt;
      sum.s += ss;
      sum.score += score;
      people++;

      result.push(`${name}/${f}/${i}/${m}/${t2}/${s2}/${score}`);
      continue;
    }

    /* âœ… ê·¸ ì™¸ ëª¨ë“  ì¤„ì€ ì›ë³¸ ê·¸ëŒ€ë¡œ */
    result.push(raw);
  }

  document.getElementById("output").textContent = result.join("\n");

  /* ---------- í™•ì¸ìš© ìš”ì•½ ---------- */
  const goal = people * 7;
  const status = sum.score >= goal ? "âœ… ë‹¬ì„±" : "âš ï¸ ë¯¸ë‹¬";

  let summaryText =
`ì¢…í•© : ${sum.f}/${sum.i}/${sum.m}/${sum.t}/${sum.s}//${sum.score}

ì¡°ì´ì ìˆ˜: ${sum.score}ì 
ëª©í‘œ: ${goal}ì  / í˜„ì¬: ${sum.score}ì  ${status}`;

  if (warnings.length) {
    summaryText += `\n\nâš ï¸ ìˆ˜ì¹˜ í™•ì¸ í•„ìš”\n${warnings.join("\n")}`;
  }

  document.getElementById("summary").textContent = summaryText;
}

/* ---------- ë³µì‚¬ ---------- */
function copyResult() {
  const t = document.getElementById("output").textContent;
  if (!t) return;
  navigator.clipboard.writeText(t).then(() => {
    alert("âœ… ë³µì‚¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");
  }).catch(() => {
    alert("âŒ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
  });
}
</script>

</body>
</html>

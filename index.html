<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ¦¾ ë„ì „ ì¼ìƒ íŠ¹ì „ëŒ€! ì¼ì¼ë³´ê³  ê³„ì‚°ê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f7f7f7;
      margin: 20px;
    }
    textarea {
      width: 100%;
      height: 260px;
      padding: 10px;
      font-size: 14px;
      box-sizing: border-box;
    }
    button {
      margin: 6px 4px 0 0;
      padding: 10px 18px;
      font-size: 14px;
      cursor: pointer;
    }
    pre, .box {
      background: #fff;
      padding: 12px;
      margin-top: 12px;
      border: 1px solid #ccc;
      white-space: pre-wrap;
    }
    .group-buttons button.active {
      background: #222;
      color: #fff;
    }
  </style>
</head>
<body>

<h2>ğŸ¦¾ ë„ì „ ì¼ìƒ íŠ¹ì „ëŒ€! ì¼ì¼ë³´ê³  ìë™ ê³„ì‚°ê¸°</h2>

<div class="group-buttons">
  <strong>ì¡° ì„ íƒ:</strong>
  <button class="active" onclick="selectGroup(1,this)">1ì¡°</button>
  <button onclick="selectGroup(2,this)">2ì¡°</button>
  <button onclick="selectGroup(3,this)">3ì¡°</button>
  <button onclick="selectGroup(4,this)">4ì¡°</button>
  <button onclick="selectGroup(5,this)">5ì¡°</button>
</div>

<br>

<textarea id="input" placeholder="ì›ë³¸ ì¼ì¼ë³´ê³  ì–‘ì‹ì„ ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”"></textarea>
<br>

<button onclick="processText()">ê²°ê³¼ ë³´ê¸°</button>
<button onclick="copyResult()">ë³µì‚¬í•˜ê¸°</button>

<h3>ğŸ“‹ ê²°ê³¼</h3>
<pre id="output"></pre>

<h3>âœ… í™•ì¸ìš© ìš”ì•½ </h3>
<div class="box" id="summary"></div>

<script>
let selectedGroup = "1ì¡°";

/* ì¡° ì„ íƒ */
function selectGroup(n, btn) {
  selectedGroup = n + "ì¡°";
  document.querySelectorAll(".group-buttons button")
    .forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
}

/* ì•ì— ìˆëŠ” ìˆ«ìë§Œ ì¶”ì¶œ */
function getFrontNumber(value) {
  const match = value.trim().match(/^(\d+(\.\d+)?)/);
  return match ? parseFloat(match[1]) : 0;
}

/* ê´„í˜¸ ì•ˆ ìˆ«ì í•©ê³„ */
function getBracketSum(value) {
  const match = value.match(/\(([^)]+)\)/);
  if (!match) return 0;
  const nums = match[1].match(/\d+(\.\d+)?/g);
  if (!nums) return 0;
  return nums.reduce((a, b) => a + parseFloat(b), 0);
}

function processText() {
  const lines = document.getElementById("input").value.split("\n");

  let result = [];
  let sum = { f:0, i:0, m:0, t:0, s:0, score:0 };
  let people = 0;
  let warnings = [];

  for (let line of lines) {
    const raw = line;
    const t = line.trim();

    // ê³„ì‚°ìš©/ë¶ˆí•„ìš” ì¤„ ì œê±°
    if (
      t === "ì´ë¦„/0/0/0/0/0/0" ||
      (t.startsWith("ex)") && t.includes("/0/0/0/0/0")) ||
      t.startsWith("í•©ê³„/")
    ) continue;

    // ì¡° í‘œì‹œ â†’ ì„ íƒê°’ìœ¼ë¡œ êµì²´
    if (t.endsWith("ì¡°")) {
      result.push("");
      result.push(selectedGroup);
      result.push("");
      continue;
    }

    // ì¡°ì´ì ìˆ˜ ì¤„ ì œê±° (ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‚½ì…)
    if (t.startsWith("=> ì¡°ì´ì ìˆ˜")) continue;

    // ì‚¬ëŒ ë°ì´í„°
    if (t.includes("/") && t.split("/").length === 6 && !t.startsWith("ì´ë¦„")) {
      const [name,f,i,m,t2,s2] = t.split("/");

      const fields = [
        ["ì°¾ê¸°", f],
        ["ì„­ì™¸", i],
        ["ë§Œë‚¨", m],
        ["ìƒë”°", t2],
        ["ì„±ë”°", s2],
      ];

      fields.forEach(([label, val]) => {
        const front = getFrontNumber(val);
        const bracket = getBracketSum(val);
        if (bracket > 0 && Math.abs(front - bracket) > 0.001) {
          warnings.push(
            `- ${name} / ${label}ì¹¸ì— ìˆ˜ì¹˜ì˜ í•©ê³„ê°€ í‹€ë¦½ë‹ˆë‹¤.`
          );
        }
      });

      const ff = getFrontNumber(f);
      const ii = getFrontNumber(i);
      const mm = getFrontNumber(m);
      const tt = getFrontNumber(t2);
      const ss = getFrontNumber(s2);

      const score = ff + ii*2 + mm*3 + tt*4 + ss*5;

      sum.f += ff;
      sum.i += ii;
      sum.m += mm;
      sum.t += tt;
      sum.s += ss;
      sum.score += score;
      people++;

      result.push(raw); // ì¶œë ¥ì€ ì›ë³¸ ê·¸ëŒ€ë¡œ
      continue;
    }

    // ë‚˜ë¨¸ì§€ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€
    result.push(raw);
  }

  // ì¡°ì´ì ìˆ˜ ì‚½ì…
  const headerIndex = result.findIndex(l => l.includes("ì´ë¦„/ì°¾ê¸°"));
  if (headerIndex !== -1) {
    result.splice(
      headerIndex + people + 2,
      0,
      "",
      `=> ì¡°ì´ì ìˆ˜ : ${sum.score}ì `,
      ""
    );
  }

  document.getElementById("output").textContent = result.join("\n");

  const goal = people * 7;
  const status = sum.score >= goal ? "âœ… ë‹¬ì„±" : "âš ï¸ ë¯¸ë‹¬";

  document.getElementById("summary").textContent =
`ì¡°ì´ì ìˆ˜: ${sum.score}ì 
ëª©í‘œ: ${goal}ì  / í˜„ì¬: ${sum.score}ì  ${status}` +
(warnings.length
  ? `\n\nâš ï¸ ìˆ˜ì¹˜ í™•ì¸ í•„ìš”\n${warnings.join("\n")}`
  : "");
}

function copyResult() {
  const text = document.getElementById("output").textContent;
  if (!text) return;
  navigator.clipboard.writeText(text).then(() => {
    alert("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤ âœ…");
  });
}
</script>

</body>
</html>
